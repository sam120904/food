{% extends 'base.html' %}

{% block content %}
<div class="max-w-3xl mx-auto px-4 py-8">
    <div class="mb-8 text-center">
        <h1 class="text-3xl font-black text-[#0d1b0d] dark:text-white mb-2">Create Donation Listing</h1>
        <p class="text-slate-500">Bridge the gap between surplus and hunger. Your contribution matters.</p>
    </div>

    <!-- Form Container -->
    <div
        class="bg-white dark:bg-[#1a2e1a] rounded-xl border border-[#cfe7cf] dark:border-[#2a3d2a] shadow-sm overflow-hidden">
        <form method="post" enctype="multipart/form-data" id="donation-form" class="p-8">
            {% csrf_token %}

            <!-- Step 1: Food Information -->
            <div id="step-1" class="space-y-6">
                <!-- Header (Hidden in Step 2) -->
                <div class="flex items-center gap-3 mb-6 pb-6 border-b border-[#cfe7cf] dark:border-[#2a3d2a]">
                    <div class="p-2 bg-[#e7f3e7] dark:bg-primary/20 rounded-lg text-primary">
                        <span class="material-symbols-outlined">restaurant</span>
                    </div>
                    <div>
                        <h2 class="font-bold text-xl">Food Information</h2>
                        <p class="text-xs text-slate-500">Step 1 of 2</p>
                    </div>
                </div>

                <!-- Category -->
                <div class="space-y-1">
                    <label class="font-bold text-sm text-[#0d1b0d] dark:text-white">Food Category</label>
                    <div class="relative">
                        <select name="food_type" required
                            class="w-full bg-slate-50 dark:bg-black/20 border border-[#cfe7cf] dark:border-[#2a3d2a] rounded-lg px-4 py-3 text-sm focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary appearance-none cursor-pointer">
                            <option value="" disabled selected>Select type</option>
                            <option value="cooked">Cooked Meal</option>
                            <option value="raw">Raw Ingredients</option>
                            <option value="packaged">Packaged Food</option>
                        </select>
                        <!-- <svg class="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 pointer-events-none"
                            fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7">
                            </path>
                        </svg> -->
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Quantity -->
                    <div class="space-y-1">
                        <label class="font-bold text-sm text-[#0d1b0d] dark:text-white">Quantity (approx
                            KG)</label>
                        <input type="number" name="quantity_kg" step="0.1" required
                            class="w-full bg-slate-50 dark:bg-black/20 border border-[#cfe7cf] dark:border-[#2a3d2a] rounded-lg px-4 py-3 text-sm focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary"
                            placeholder="e.g. 15">
                    </div>
                    <!-- Portions (Mock field for now, saving to desc or just UI) -->
                    <div class="space-y-1">
                        <label class="font-bold text-sm text-[#0d1b0d] dark:text-white">Servings Count</label>
                        <input type="number" name="servings" required
                            class="w-full bg-slate-50 dark:bg-black/20 border border-[#cfe7cf] dark:border-[#2a3d2a] rounded-lg px-4 py-3 text-sm focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary"
                            placeholder="Serves how many people?">
                    </div>
                </div>

                <!-- Dietary Preference (Using radio buttons style) -->
                <div class="space-y-2">
                    <label class="font-bold text-sm text-[#0d1b0d] dark:text-white">Dietary Preference</label>
                    <div class="flex gap-4">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="dietary" value="veg" class="peer hidden" checked>
                            <div
                                class="flex items-center justify-center gap-2 p-3 rounded-lg border border-[#cfe7cf] dark:border-[#2a3d2a] peer-checked:bg-[#e7f3e7] dark:peer-checked:bg-primary/20 peer-checked:border-primary peer-checked:text-primary transition-all">
                                <span class="material-symbols-outlined text-lg">eco</span>
                                <span class="font-bold text-sm">Vegetarian</span>
                            </div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="dietary" value="non-veg" class="peer hidden">
                            <div
                                class="flex items-center justify-center gap-2 p-3 rounded-lg border border-[#cfe7cf] dark:border-[#2a3d2a] peer-checked:bg-red-50 dark:peer-checked:bg-red-900/20 peer-checked:border-red-500 peer-checked:text-red-500 transition-all">
                                <span class="material-symbols-outlined text-lg">kebab_dining</span>
                                <span class="font-bold text-sm">Non-Vegetarian</span>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Description -->
                <div class="space-y-1">
                    <label class="font-bold text-sm text-[#0d1b0d] dark:text-white">Items Description</label>
                    <textarea name="description" rows="4" required
                        class="w-full bg-slate-50 dark:bg-black/20 border border-[#cfe7cf] dark:border-[#2a3d2a] rounded-lg px-4 py-3 text-sm focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary resize-none"
                        placeholder="List the items (e.g. 5kg Dal Tadka, 2kg Rice, 20 Rotis)"></textarea>
                </div>
            </div>

            <!-- Step 2: Safety & Expiry -->
            <div id="step-2" class="hidden space-y-6">
                <div class="flex items-center gap-3 mb-6 pb-6 border-b border-[#cfe7cf] dark:border-[#2a3d2a]">
                    <div class="p-2 bg-[#e7f3e7] dark:bg-primary/20 rounded-lg text-primary">
                        <span class="material-symbols-outlined">health_and_safety</span>
                    </div>
                    <div>
                        <h2 class="font-bold text-xl">Safety & Expiry</h2>
                        <p class="text-xs text-slate-500">Step 2 of 2</p>
                    </div>
                </div>

                <!-- Expiry -->
                <div class="space-y-1">
                    <label class="font-bold text-sm text-[#0d1b0d] dark:text-white">Consume By (Expiry)</label>
                    <input type="datetime-local" name="expiry_time" required
                        class="w-full bg-slate-50 dark:bg-black/20 border border-[#cfe7cf] dark:border-[#2a3d2a] rounded-lg px-4 py-3 text-sm focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary [color-scheme:light] dark:[color-scheme:dark]">
                </div>

                <!-- Pickup Instructions -->
                <div class="space-y-1">
                    <label class="font-bold text-sm text-[#0d1b0d] dark:text-white">Pickup Instructions</label>
                    <textarea name="pickup_instructions" rows="2"
                        class="w-full bg-slate-50 dark:bg-black/20 border border-[#cfe7cf] dark:border-[#2a3d2a] rounded-lg px-4 py-3 text-sm focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary resize-none"
                        placeholder="Address already saved. Any specific gate or landmark?"></textarea>
                </div>

                <!-- Image Upload -->
                <div class="space-y-1">
                    <label class="font-bold text-sm text-[#0d1b0d] dark:text-white">Add Photo
                        (Recommended)</label>
                    <div
                        class="border-2 border-dashed border-[#cfe7cf] dark:border-[#2a3d2a] rounded-xl p-6 flex flex-col items-center justify-center text-center cursor-pointer hover:border-primary hover:bg-[#e7f3e7] dark:hover:bg-primary/10 transition-colors group relative">
                        <input type="file" name="image" class="absolute inset-0 opacity-0 cursor-pointer"
                            onchange="previewImage(this)">
                        <div id="upload-placeholder">
                            <span
                                class="material-symbols-outlined text-3xl text-slate-400 group-hover:text-primary mb-2">add_a_photo</span>
                            <p class="text-sm font-bold text-slate-500 group-hover:text-primary">Click to upload
                            </p>
                            <p class="text-xs text-slate-400">JPG, PNG max 5MB</p>
                        </div>
                        <img id="img-preview" src="#"
                            class="hidden h-32 object-cover rounded-lg shadow-md z-10 pointer-events-none">
                    </div>
                </div>

                <!-- Safety Check (Mock) -->
                <div
                    class="bg-yellow-50 dark:bg-yellow-900/10 p-4 rounded-lg border border-yellow-100 dark:border-yellow-900/30 flex gap-3 items-start">
                    <input type="checkbox" required
                        class="mt-1 rounded border-yellow-300 text-yellow-600 focus:ring-yellow-500 cursor-pointer">
                    <div class="text-xs text-yellow-800 dark:text-yellow-400">
                        <strong>I confirm that this food is fresh, hygienic, and safe for
                            consumption.</strong><br>
                        Unsafe food donation can lead to permanent ban.
                    </div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="pt-8 flex items-center justify-between border-t border-[#cfe7cf] dark:border-[#2a3d2a] mt-6">
                <button type="button" id="prev-btn"
                    class="hidden px-6 py-2 text-sm font-bold text-slate-500 hover:text-[#0d1b0d] hover:bg-slate-100 rounded-lg transition-colors">
                    Back
                </button>
                <button type="button" id="next-btn"
                    class="px-8 py-3 bg-[#0d1b0d] text-white font-bold rounded-lg shadow-lg hover:scale-105 transition-transform flex items-center gap-2 ml-auto">
                    Next: Safety & Expiry <span class="material-symbols-outlined">arrow_forward</span>
                </button>
                <button type="submit" id="submit-btn"
                    class="hidden px-8 py-3 bg-primary text-[#0d1b0d] font-bold rounded-lg shadow-lg hover:scale-105 transition-transform items-center gap-2">
                    Post Donation <span class="material-symbols-outlined">check</span>
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    const step1 = document.getElementById('step-1');
    const step2 = document.getElementById('step-2');
    const nextBtn = document.getElementById('next-btn');
    const prevBtn = document.getElementById('prev-btn');
    const submitBtn = document.getElementById('submit-btn');

    let currentStep = 1;

    nextBtn.addEventListener('click', () => {
        // Validate Step 1 (Simple HTML5 validation check)
        const step1Inputs = step1.querySelectorAll('input, select, textarea');
        let isValid = true;
        step1Inputs.forEach(input => {
            if (!input.checkValidity()) {
                input.reportValidity();
                isValid = false;
            }
        });

        if (isValid) {
            goToStep(2);
        }
    });

    prevBtn.addEventListener('click', () => {
        goToStep(1);
    });

    function goToStep(step) {
        currentStep = step;
        if (step === 1) {
            step1.classList.remove('hidden');
            step2.classList.add('hidden');
            nextBtn.classList.remove('hidden');
            submitBtn.classList.add('hidden');
            prevBtn.classList.add('hidden');
            nextBtn.classList.remove('ml-0');
            nextBtn.classList.add('ml-auto');
        } else {
            step1.classList.add('hidden');
            step2.classList.remove('hidden');
            nextBtn.classList.add('hidden');
            submitBtn.classList.remove('hidden');
            prevBtn.classList.remove('hidden');
            // Submit button inherits ml-auto from structure or flex logic above
            submitBtn.classList.add('ml-auto');
        }
    }

    function previewImage(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('img-preview').src = e.target.result;
                document.getElementById('img-preview').classList.remove('hidden');
                document.getElementById('upload-placeholder').classList.add('hidden');
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>
{% endblock %}